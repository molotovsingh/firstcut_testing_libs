{
  "order_id": "docling-fix-parsev4-pipeline-options",
  "priority": "urgent",
  "context": {
    "repository": "docling_langextract_testing",
    "issue": "Parse V4 now hits 'ConvertPipelineOptions' object has no attribute generate_page_images.",
    "root_cause": "StandardPdfPipeline expects PdfPipelineOptions, but DocumentProcessor passes ConvertPipelineOptions.",
    "current_state": [
      "Fix #docling-fix-parsev4 introduced StandardPdfPipeline for Parse V4.",
      "The options object remains ConvertPipelineOptions, missing StandardPdfPipeline fields (generate_page_images, images_scale, etc.).",
      "PDF uploads still fail, producing fallback records despite the pipeline class swap." 
    ]
  },
  "tasks": [
    {
      "id": "analyze-pdf-options",
      "description": "Determine the required PdfPipelineOptions defaults for Parse V4.",
      "steps": [
        "Inspect docling.datamodel.pipeline_options.PdfPipelineOptions and identify the fields Docling expects.",
        "Decide how to map existing DoclingConfig settings (OCR, table structure, timeout, accelerator options) to the PdfPipelineOptions constructor." 
      ]
    },
    {
      "id": "update-document-processor",
      "description": "Instantiate PdfPipelineOptions for Parse V4 and keep ConvertPipelineOptions for other formats.",
      "steps": [
        "When backend == 'v2', continue using ConvertPipelineOptions + SimplePipeline.",
        "When backend != 'v2', build a PdfPipelineOptions instance with appropriate flags (generate_page_images, do_table_structure, accelerator options, etc.) and pass it to FormatOption with StandardPdfPipeline.",
        "Ensure missing attributes (images_scale, generate_picture_images, etc.) have sensible defaults or are configurable via DoclingConfig." 
      ]
    },
    {
      "id": "verification",
      "description": "Confirm Parse V4 path now succeeds.",
      "steps": [
        "Re-run a PDF extraction (e.g., tests/test_documents/sample_docling.pdf or a real Amrapali PDF).",
        "Verify the log no longer reports missing attributes and that extraction_method == 'docling'.",
        "Document results under docs/reports/docling-fix-parsev4.txt (append a new section with date and outcome)." 
      ]
    }
  ],
  "acceptance_criteria": [
    "DocumentProcessor uses PdfPipelineOptions whenever StandardPdfPipeline is selected.",
    "Docling no longer raises the 'generate_page_images' attribute error for PDFs.",
    "Successful extraction proof recorded in docs/reports/docling-fix-parsev4.txt.",
    "Parse V4 PDFs produce real Docling output (no fallback records caused by pipeline mismatch)." 
  ],
  "notes": "Focus on the pipeline options wiring; avoid unrelated refactors while the regression is active."
}
