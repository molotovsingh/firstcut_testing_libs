{
  "order_id": "docling-fix-parsev4",
  "priority": "high",
  "context": {
    "repository": "docling_langextract_testing",
    "issue": "DoclingParseV4DocumentBackend paired with SimplePipeline causes runtime failure for PDFs.",
    "error_message": "The selected backend DoclingParseV4DocumentBackend ... is not a declarative backend. Can not convert this with simple pipeline.",
    "current_state": [
      "DocumentProcessor uses SimplePipeline for both Parse V2 and Parse V4 backends.",
      "Parse V4 requires the declarative pipeline, so PDFs fail during extraction.",
      "Users report DOC LING FAILED for PDF uploads when backend is v4." 
    ]
  },
  "tasks": [
    {
      "id": "inspect-docling-api",
      "description": "Confirm the correct declarative pipeline class for Docling Parse V4 backend.",
      "steps": [
        "Identify which pipeline class (e.g., DeclarativePipeline or DoclingDeclarativePipeline) ships with the installed docling version.",
        "Document the import path and ensure it is available in the environment." 
      ]
    },
    {
      "id": "update-document-processor",
      "description": "Adjust DocumentProcessor to select the proper pipeline per backend.",
      "steps": [
        "In docling v2 mode, continue using SimplePipeline.",
        "For the default v4 backend, swap the pipeline_cls to the declarative pipeline.",
        "Add necessary imports and guard against missing classes (handle ImportError with a clear message)."
      ]
    },
    {
      "id": "add-regression-test",
      "description": "Protect against regression by adding a test or smoke check.",
      "steps": [
        "Create a minimal test covering the PDF path using Parse V4 and verifying that extraction returns text instead of failing.",
        "If direct PDF processing is too heavy for automated tests, add a lightweight integration check or documented manual test procedure referencing tests/test_documents/sample.pdf." 
      ]
    },
    {
      "id": "verification",
      "description": "Run and record verification steps.",
      "steps": [
        "Reproduce the original failing scenario (Process a PDF with backend v4).",
        "Confirm the pipeline successfully extracts and logs no backend mismatch errors.",
        "Capture the verification output (screenshot, log snippet, or Streamlit run) and save a note under docs/reports/docling-fix-parsev4.txt." 
      ]
    }
  ],
  "acceptance_criteria": [
    "PDF processing with Parse V4 no longer throws the declarative backend error.",
    "DocumentProcessor selects SimplePipeline for v2 and the declarative pipeline for v4.",
    "A regression test or documented repro ensures the fix is pinned for future refactors.",
    "Verification evidence recorded in docs/reports/docling-fix-parsev4.txt." 
  ],
  "notes": "Avoid making other Docling changes; focus solely on pipeline selection for Parse V4."
}
